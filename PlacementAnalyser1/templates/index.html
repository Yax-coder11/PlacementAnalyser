<html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resume Builder - Create Professional Resumes Online</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&amp;family=Open+Sans:wght@400;600&amp;display=swap" rel="stylesheet">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Custom CSS -->
  <link href="/static/css/style.css" rel="stylesheet">
  <style>
    /* Custom styles for the resume builder */
    .navbar { background-color: #1a365d; }
    .btn-primary { background-color: #1a365d; border-color: #1a365d; }
    .btn-primary:hover { background-color: #152a4a; border-color: #152a4a; }
    .form-control:focus { border-color: #1a365d; box-shadow: 0 0 0 0.25rem rgba(26, 54, 93, 0.25); }
    #resume, #signin, #signup { display: none; }
    #preview { display: none; white-space: pre-line; }
    .toast { position: fixed; top: 20px; right: 20px; z-index: 9999; }
    .hero-section {
      background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
      color: white;
      padding: 5rem 0;
      margin-bottom: 3rem;
      border-radius: 0 0 20px 20px;
    }
    .feature-card {
      border: none;
      border-radius: 10px;
      transition: transform 0.3s ease;
      margin-bottom: 20px;
      height: 100%;
    }
    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .feature-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      color: #1a365d;
    }
    #home {
    display: block !important;  /* Force display home section */
}
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#" onclick="showHome()">
        <i class="fas fa-file-alt me-2"></i>ResumeNow
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#" onclick="showHome()">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="showTemplates()">Templates</a>
          </li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item">
            <button class="btn btn-outline-light me-2" onclick="showSignin()">
              <i class="fas fa-sign-in-alt me-1"></i>Sign In
            </button>
          </li>
          <li class="nav-item">
            <button class="btn btn-primary" onclick="showSignup()">
              <i class="fas fa-user-plus me-1"></i>Sign Up
            </button>
          </li>
          <li class="nav-item ms-2 d-none" id="userMenu">
            <div class="dropdown">
              <button class="btn btn-outline-light dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown">
                <i class="fas fa-user-circle me-1"></i>
                <span id="userName">User</span>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#" onclick="startResume()">Create Resume</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#" onclick="logout()">Sign Out</a></li>
              </ul>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Home Section -->
  <div id="home" style="display: none;">
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container text-center">
        <h1 class="display-4 fw-bold mb-4">Create Your Professional Resume</h1>
        <p class="lead mb-4">Build a professional resume in minutes with our easy-to-use resume builder</p>
        <button class="btn btn-light btn-lg me-2" onclick="startResume()">
          <i class="fas fa-plus-circle me-2"></i>Create My Resume
        </button>
        <button class="btn btn-outline-light btn-lg" onclick="showTemplates()">
          <i class="fas fa-th-large me-2"></i>View Templates
        </button>
      </div>
    </section>

    <!-- Features Section -->
    <section class="container my-5">
      <div class="row g-4">
        <div class="col-md-4">
          <div class="card feature-card h-100 p-4">
            <div class="text-center">
              <div class="feature-icon">
                <i class="fas fa-magic"></i>
              </div>
              <h4>Easy to Use</h4>
              <p>Create a professional resume in minutes with our intuitive drag-and-drop interface.</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card feature-card h-100 p-4">
            <div class="text-center">
              <div class="feature-icon">
                <i class="fas fa-file-alt"></i>
              </div>
              <h4>Professional Templates</h4>
              <p>Choose from a variety of ATS-friendly templates designed by HR professionals.</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card feature-card h-100 p-4">
            <div class="text-center">
              <div class="feature-icon">
                <i class="fas fa-download"></i>
              </div>
              <h4>Download &amp; Share</h4>
              <p>Download your resume as PDF or share it online with potential employers.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Resume Form Section -->
  <div id="resume" class="container py-5" style="display: none;">
    <!-- ... (keep the existing resume form code) ... -->
  </div>

  <!-- Sign In Section -->
  <div id="signin" class="container py-5" style="max-width: 500px; display: block;">
    <div class="card shadow">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Sign In</h4>
      </div>
      <div class="card-body">
        <form id="loginForm" onsubmit="handleLogin(event)">
          <div class="mb-3">
            <label for="loginEmail" class="form-label">Email address</label>
            <input type="email" class="form-control" id="loginEmail" required="">
          </div>
          <div class="mb-3">
            <label for="loginPassword" class="form-label">Password</label>
            <input type="password" class="form-control" id="loginPassword" required="">
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-primary">
              <span class="btn-text">Sign In</span>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
          </div>
        </form>
        <div class="text-center mt-3">
          <p class="mb-0">Don't have an account? <a href="#" onclick="showSignup()">Sign up</a></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Sign Up Section -->
  <div id="signup" class="container py-5" style="max-width: 500px; display: none;">
    <div class="card shadow">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Create an Account</h4>
      </div>
      <div class="card-body">
        <form id="signupForm" onsubmit="handleSignup(event)">
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="firstName" class="form-label">First Name</label>
              <input type="text" class="form-control" id="firstName" required="">
            </div>
            <div class="col-md-6">
              <label for="lastName" class="form-label">Last Name</label>
              <input type="text" class="form-control" id="lastName" required="">
            </div>
          </div>
          <div class="mb-3">
            <label for="signupEmail" class="form-label">Email address</label>
            <input type="email" class="form-control" id="signupEmail" required="">
          </div>
          <div class="mb-3">
            <label for="signupPassword" class="form-label">Password</label>
            <input type="password" class="form-control" id="signupPassword" required="">
          </div>
          <div class="mb-3">
            <label for="confirmPassword" class="form-label">Confirm Password</label>
            <input type="password" class="form-control" id="confirmPassword" required="">
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-primary">
              <span class="btn-text">Sign Up</span>
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            </button>
          </div>
        </form>
        <div class="text-center mt-3">
          <p class="mb-0">Already have an account? <a href="#" onclick="showSignin()">Sign in</a></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast align-items-center text-white" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastMessage">
        Operation completed successfully!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>

  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Global variables
    let currentUser = null;
    const toastEl = document.querySelector('.toast');
    const toast = new bootstrap.Toast(toastEl, { delay: 3000 });

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
  // Always show home page first
  showHome();
  
  // Check auth status in the background
  checkAuth().then(authenticated => {
    if (authenticated) {
      updateUIForLoggedInUser();
    }
  });
});

    // Check authentication status
    function checkAuth() {
      return fetch('/check_auth')
        .then(response => response.json())
        .then(data => {
          if (data.authenticated) {
            currentUser = {
              id: data.user_id,
              email: data.email,
              name: data.name || data.email.split('@')[0]
            };
            return true;
          }
          return false;
        })
        .catch(error => {
          console.error('Auth check failed:', error);
          return false;
        });
    }

    // Update UI for logged in user
    function updateUIForLoggedInUser() {
      document.getElementById('userMenu').classList.remove('d-none');
      document.querySelector('.navbar-nav .btn-outline-light').parentElement.classList.add('d-none');
      document.querySelector('.navbar-nav .btn-primary').parentElement.classList.add('d-none');
      if (currentUser) {
        document.getElementById('userName').textContent = currentUser.name;
      }
    }

    // Show toast message
    function showToast(message, isError = false) {
      const toastMessage = document.getElementById('toastMessage');
      toastEl.classList.remove('bg-success', 'bg-danger');
      toastEl.classList.add(isError ? 'bg-danger' : 'bg-success');
      toastMessage.textContent = message;
      toast.show();
    }

    // Show home page
    function showHome() {
    // Hide all sections first
    document.getElementById('home').style.display = 'block';
    document.getElementById('resume').style.display = 'none';
    document.getElementById('signin').style.display = 'none';
    document.getElementById('signup').style.display = 'none';
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    // Update active nav link
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
    });
    document.querySelector('.nav-link[onclick="showHome()"]').classList.add('active');
}

    // Show sign in page
    function showSignin() {
      document.getElementById('home').style.display = 'none';
      document.getElementById('resume').style.display = 'none';
      document.getElementById('signin').style.display = 'block';
      document.getElementById('signup').style.display = 'none';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Show sign up page
    function showSignup() {
      document.getElementById('home').style.display = 'none';
      document.getElementById('resume').style.display = 'none';
      document.getElementById('signin').style.display = 'none';
      document.getElementById('signup').style.display = 'block';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Handle login form submission
    async function handleLogin(event) {
  event.preventDefault();
  const form = event.target;
  const formData = new FormData(form);
  const loginBtn = form.querySelector('button[type="submit"]');
  const btnText = loginBtn.querySelector('.btn-text');
  const spinner = loginBtn.querySelector('.spinner-border');

  // Show loading state
  loginBtn.disabled = true;
  btnText.textContent = 'Signing in...';
  spinner.classList.remove('d-none');

  try {
    const response = await fetch('/signin', {
      method: 'POST',
      body: new URLSearchParams(formData)
    });

    const data = await response.json();

    if (data.success) {
      showToast('Login successful!');
      // Update UI for logged in user
      currentUser = {
        id: data.user_id,
        email: formData.get('email')
      };
      updateUIForLoggedInUser();
      // Redirect to home page
      window.location.href = data.redirect || '/';
    } else {
      throw new Error(data.error || 'Login failed');
    }
  } catch (error) {
    console.error('Login error:', error);
    showToast(error.message || 'Login failed. Please try again.', true);
  } finally {
    loginBtn.disabled = false;
    btnText.textContent = 'Sign In';
    spinner.classList.add('d-none');
  }
}

    // Handle signup form submission
    async function handleSignup(event) {
      event.preventDefault();
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const signupBtn = event.target.querySelector('button[type="submit"]');
      const btnText = signupBtn.querySelector('.btn-text');
      const spinner = signupBtn.querySelector('.spinner-border');

      // Validate passwords match
      if (password !== confirmPassword) {
        showToast('Passwords do not match!', true);
        return;
      }

      // Show loading state
      signupBtn.disabled = true;
      btnText.textContent = 'Creating Account...';
      spinner.classList.remove('d-none');

      try {
        const response = await fetch('/signup', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: new URLSearchParams({
            first_name: firstName,
            last_name: lastName,
            email: email,
            password: password
          })
        });

        const data = await response.json();

        if (data.success) {
          showToast('Account created successfully! Please sign in.');
          showSignin();
          // Clear form
          event.target.reset();
        } else {
          throw new Error(data.error || 'Registration failed');
        }
      } catch (error) {
        console.error('Signup error:', error);
        showToast(error.message || 'Registration failed. Please try again.', true);
      } finally {
        signupBtn.disabled = false;
        btnText.textContent = 'Sign Up';
        spinner.classList.add('d-none');
      }
    }

    // Logout function
    async function logout() {
      try {
        const response = await fetch('/logout', { method: 'POST' });
        if (response.ok) {
          currentUser = null;
          document.getElementById('userMenu').classList.add('d-none');
          document.querySelector('.navbar-nav .btn-outline-light').parentElement.classList.remove('d-none');
          document.querySelector('.navbar-nav .btn-primary').parentElement.classList.remove('d-none');
          showToast('Successfully logged out');
          showHome();
        }
      } catch (error) {
        console.error('Logout error:', error);
        showToast('Error logging out', true);
      }
    }

    // Start resume creation
    async function startResume() {
      const isAuthenticated = await checkAuth();
      
      if (isAuthenticated) {
        document.getElementById('home').style.display = 'none';
        document.getElementById('signin').style.display = 'none';
        document.getElementById('signup').style.display = 'none';
        document.getElementById('resume').style.display = 'block';
        document.getElementById('resume').scrollIntoView({ behavior: 'smooth' });
      } else {
        showSignin();
      }
    }

    // Show templates
    function showTemplates() {
      showToast('Template selection coming soon!');
    }
    // Force show home page after everything loads
    window.onload = function() {
      showHome();
    };
  </script>

</body></html>